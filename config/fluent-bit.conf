[SERVICE]
    Flush        1
    Log_Level    info
    Parsers_File parsers.conf

[INPUT]
    Name         tail
    Path         /var/log/apps/app.log
    Tag          app.logs
    Refresh_Interval 1
    Parser       my_json_parser
    Mem_Buf_Limit 5MB
    Skip_Long_Lines On

# ---------------------------------------------------------
# Output 1: 原始日誌存檔 (OpenSearch)
# 用途：保留完整的原始證據，不做任何 AI 分析，供日後查詢。
# ---------------------------------------------------------
[OUTPUT]
    Name  opensearch
    Match *
    Host  opensearch-node
    Port  9200
    # 可將 Index 改名，區分「原始 Log」與「AI 分析後的 Log」
    Index security-logs-raw
    tls   Off
    Suppress_Type_Name On
    HTTP_User admin
    HTTP_Pass admin

# ---------------------------------------------------------
# Output 2: 觸發 AI 分析 (RabbitMQ)
# 用途：將 Log 丟進 Queue，讓 Python Worker 拿去跑 AI 偵測
# ---------------------------------------------------------
[OUTPUT]
    Name           amqp
    Match          *
    Host           rabbitmq
    Port           5672
    User           guest
    Password       guest
    Exchange       cti_exchange
    Routing_Key    cti_queue
    Exchange_Type  direct
    Format         json 
    Durable        On